<!DOCTYPE html>
<html>
<head>
  <title>Leaderboard</title>
  <link rel="stylesheet" href="style.css">

<script data-goatcounter="https://sccfantasyashes.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>



  <style>
    /* Fixed site-wide header */
    .site-header {
      background-color: skyblue;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.6rem;
      font-weight: bold;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }

    /* Fixed navbar just below header */
    .navbar {
      background: #0B1636;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 12px;
      position: fixed;
      top: 70px;
      left: 0;
      width: 100%;
      z-index: 999;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: 600;
    }

    .navbar a.active {
      text-decoration: underline;
    }

    body {
      margin: 0;
      padding-top: 130px; /* header + navbar height */
    }

    .leaderboard-page {
      padding: 25px;
      background: #f5f5f5;
      min-height: 100vh;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: #0B1636;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      max-width: 960px;
      margin: 0 auto;
    }

    #tableWrap {
      overflow-x: auto;
      max-height: 750px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }

    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      font-weight: 700;
      background: #f1f5f9;
      position: sticky;
      top: 0;
      z-index: 5;
    }

    #leaderboard th, #leaderboard td {
      text-align: center;
    }

    #leaderboard th:nth-child(2),
    #leaderboard td:nth-child(2) {
      text-align: left !important;
    }

    tr.rank-1 { background-color: #fff176 !important; }
    tr.rank-2 { background-color: #fff9c4 !important; }
    tr.rank-3 { background-color: #fffde7 !important; }

    .meta {
      color: #6b7280;
      font-size: 0.9rem;
    }

    .refresh {
      float: right;
      font-size: 0.9rem;
      color: #2563eb;
      cursor: pointer;
      text-decoration: underline;
    }

    .highlight-max {
    font-weight: bold;
    color: red;
    }

    .total-col { font-weight: bold; }
  </style>


  <!-- PNG Favicons for modern browsers -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">


</head>

<body>

<!-- Fixed site-wide header -->
<div class="site-header">
  SUNBURY CRICKET CLUB - ASHES FANTASY FUNDRAISER
</div>

<!-- Fixed navbar -->
<div class="navbar">
  <a class="active" href="index.html">LEADERBOARD</a>
  <a href="teams.html">TEAMS</a>
  <a href="player-stats.html">PLAYER STATS</a>
  <a href="transfers.html">TRANSFERS</a>
  <a href="rules.html">RULES</a>
</div>

<div class="leaderboard-page">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div><h1>Leaderboard</h1></div>
      <div class="refresh" id="manualRefresh"></div>
    </div>

    <div id="lastUpdated" class="meta" style="margin-top:6px;">Last updated: —</div>
    <br>

    <div id="tableWrap">
      <table id="leaderboard">
        <thead><tr id="theadRow"></tr></thead>
        <tbody id="tbodyRow"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const SHEET_ID = "1KdJSeVfMnYqV9olfYKkUUNkLldeaKhMuXrphWPWUps0";
  const SHEET_NAME = "Leaderboard";
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

  async function fetchAndRender() {
    try {
      const res = await fetch(SHEET_URL);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));

      const cols = json.table.cols.map(c => c.label);
      const rows = json.table.rows;

      // Build header (skip column I)
      const theadRow = document.getElementById("theadRow");
      theadRow.innerHTML = "";
      cols.forEach((label, colIndex) => {
        if (colIndex === 8) return; // skip column I
        const th = document.createElement("th");
        th.textContent = label;
        theadRow.appendChild(th);
      });

      // Build body (skip column I)
      const tbodyRow = document.getElementById("tbodyRow");
      tbodyRow.innerHTML = "";
      rows.forEach((row, i) => {
        const tr = document.createElement("tr");
        if (i === 0) tr.classList.add("rank-1");
        if (i === 1) tr.classList.add("rank-2");
        if (i === 2) tr.classList.add("rank-3");

        row.c.forEach((cell, colIndex) => {
          if (colIndex === 8) return; // skip column I
          const td = document.createElement("td");
          const value = cell ? (cell.f || cell.v) : "";

          if (cols[colIndex] && cols[colIndex].toLowerCase() === "total") {
            td.textContent = value;
            td.classList.add("total-col");
          } else {
            td.textContent = value;
          }

          tr.appendChild(td);
        });
        tbodyRow.appendChild(tr);
      });

      // Use I1 (header label for column I) as "Last updated"
      const lastUpdatedLabel = json.table.cols[8] ? json.table.cols[8].label : null;
      document.getElementById("lastUpdated").textContent =
        "Last updated: " + (lastUpdatedLabel || "—");


      // Highlight max value in each column (all ties, skip TOTAL column, skip zeros)
      const table = document.getElementById("leaderboard");
      const rowsEls = table.querySelectorAll("tbody tr");
      const headers = table.querySelectorAll("thead th");
      const colCount = headers.length;

      for (let colIndex = 0; colIndex < colCount; colIndex++) {
        const headerText = headers[colIndex].textContent.trim().toLowerCase();

      // Skip TOTAL and RANK columns
      if (headerText === "total" || headerText === "rank") continue;

      let maxVal = -Infinity;

      // First pass: find max value in this column
      rowsEls.forEach(row => {
        const cell = row.cells[colIndex];
        if (!cell) return;
        const val = parseFloat(cell.textContent.replace(/,/g, ""));
        if (!isNaN(val) && val > maxVal) {
          maxVal = val;
        }
      });

      // Second pass: highlight all cells equal to max (but not zero)
      rowsEls.forEach(row => {
        const cell = row.cells[colIndex];
        if (!cell) return;
        const val = parseFloat(cell.textContent.replace(/,/g, ""));
        if (!isNaN(val) && val === maxVal && val !== 0) {
          cell.classList.add("highlight-max");
        }
      });
    }



    } catch (err) {
      console.error("Error fetching data", err);
      document.getElementById("lastUpdated").textContent = "Error fetching data";
    }
  }

  document.getElementById("manualRefresh").addEventListener("click", fetchAndRender);
  fetchAndRender();
</script>
</body>
</html>
