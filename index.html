<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SUNBURY CC - Ashes Fantasy Competition</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9; }
  h1, h2 { color:#001f5b; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; background:#fff; }
  th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
  th { background: #f2f2f2; }
  tr.role-header td { background: #e6e6e6; font-weight: 700; text-align: left; }
  #summary { background:#fff; border:1px solid #ccc; border-radius:6px; padding:10px; margin-top:20px; margin-bottom:10px; }
  #summary span { font-weight:bold; }
  .ok { color:#0b8a44; font-weight:700; }
  .bad { color:red; font-weight:700; }
  .warn { background: #ffecec; transition: background 0.6s ease; }
  #message { margin-top:6px; font-weight:700; }
  caption { caption-side: top; text-align: left; font-weight: 700; color:#001f5b; padding: 6px 0; }
  #extras, #userInfo { margin-top:20px; background:#fff; border:1px solid #ccc; border-radius:6px; padding:12px; }
  label { display:block; margin-top:12px; font-weight:700; color:#001f5b; }
  input[type=text], input[type=email], select, input[type=number] { margin-top:6px; padding:6px; width:100%; max-width:520px; }
  #submitBtn { margin-top:16px; padding:10px 16px; font-size:16px; font-weight:700; background:#001f5b; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  #submitBtn:disabled { background:#ccc; cursor:not-allowed; }
  small.hint { display:block; color:#555; margin-top:4px; }
</style>
</head>
<body>

<h1>SUNBURY CC - Ashes Fantasy Competition</h1>

<div id="userInfo">
  <label for="fullName">Full Name</label>
  <input id="fullName" type="text" placeholder="Enter your full name" required />

  <label for="email">Email Address</label>
  <input id="email" type="email" placeholder="Enter your email address" required />
  <small class="hint">We’ll use this to confirm your entry and competition updates.</small>
</div>

<div id="competition-rules">
  <h2>Competition Rules and Deadline</h2>
  <ul>
    <li>Select exactly 11 players within a £75m budget.</li>
    <li>Your XI must be 5 Batters, 1 Allrounder, 1 Wicketkeeper, and 4 Bowlers.</li>
    <li>Nominate a Captain and a Vice-Captain (they must be different players).</li>
    <li>Answer the tie break question.</li>
    <li>Entries close at 2am on Friday 21st November 2025.</li>
  </ul>
  <h3>Prize Fund</h3>
  <ul>
    <li>A Cash Prize will be paid to the Winner and Runner-up. The prize fund will be 40% of the funds collected.</li>
  </ul>
</div>

<div id="summary">
  Selected: <span id="selCount" class="bad">0</span>/11 &nbsp; | &nbsp;
  Team Cost: <span id="teamCost" class="bad">£0m / £75m</span>
  <div id="roleStatus" class="bad" style="margin-top:6px;">Batters: 0/5 | Allrounders: 0/1 | Keepers: 0/1 | Bowlers: 0/4</div>
  <div id="message" aria-live="polite"></div>
</div>

<!-- Full player table -->

  <caption>Fantasy Player Selection</caption>
  <thead>
    <tr>
      <th>Select</th>
      <th>Player</th>
      <th>Country</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <!-- BATTERS -->
    <tr class="role-header"><td colspan="4">BATTERS</td></tr>
    <tr id="p_bethell"><td><input type="checkbox" class="sel"></td><td>Jacob Bethell</td><td>England</td><td>6</td></tr>
    <tr id="p_brook"><td><input type="checkbox" class="sel"></td><td>Harry Brook</td><td>England</td><td>8</td></tr>
    <tr id="p_crawley"><td><input type="checkbox" class="sel"></td><td>Zak Crawley</td><td>England</td><td>8</td></tr>
    <tr id="p_duckett"><td><input type="checkbox" class="sel"></td><td>Ben Duckett</td><td>England</td><td>7</td></tr>
    <tr id="p_head"><td><input type="checkbox" class="sel"></td><td>Travis Head</td><td>Australia</td><td>8</td></tr>
    <tr id="p_khawaja"><td><input type="checkbox" class="sel"></td><td>Usman Khawaja</td><td>Australia</td><td>8</td></tr>
    <tr id="p_labuschagne"><td><input type="checkbox" class="sel"></td><td>Marcus Labuschagne</td><td>Australia</td><td>9</td></tr>
    <tr id="p_pope"><td><input type="checkbox" class="sel"></td><td>Ollie Pope</td><td>England</td><td>7</td></tr>
    <tr id="p_root"><td><input type="checkbox" class="sel"></td><td>Joe Root</td><td>England</td><td>9</td></tr>
    <tr id="p_smith_bat"><td><input type="checkbox" class="sel"></td><td>Steve Smith</td><td>Australia</td><td>9</td></tr>
    <tr id="p_weatherald"><td><input type="checkbox" class="sel"></td><td>Jake Weatherald</td><td>Australia</td><td>6</td></tr>

    <!-- ALLROUNDERS -->
    <tr class="role-header"><td colspan="4">ALLROUNDERS</td></tr>
    <tr id="p_green"><td><input type="checkbox" class="sel"></td><td>Cameron Green</td><td>Australia</td><td>9</td></tr>
    <tr id="p_jacks"><td><input type="checkbox" class="sel"></td><td>Will Jacks</td><td>England</td><td>7</td></tr>
    <tr id="p_stokes"><td><input type="checkbox" class="sel"></td><td>Ben Stokes</td><td>England</td><td>9</td></tr>
    <tr id="p_webster"><td><input type="checkbox" class="sel"></td><td>Beau Webster</td><td>Australia</td><td>7</td></tr>

    <!-- WICKETKEEPERS -->
    <tr class="role-header"><td colspan="4">WICKETKEEPERS</td></tr>
    <tr id="p_carey"><td><input type="checkbox" class="sel"></td><td>Alex Carey</td><td>Australia</td><td>7</td></tr>
    <tr id="p_inglis"><td><input type="checkbox" class="sel"></td><td>Josh Inglis</td><td>Australia</td><td>6</td></tr>
    <tr id="p_smith_jamie"><td><input type="checkbox" class="sel"></td><td>Jamie Smith</td><td>England</td><td>6</td></tr>

    <!-- BOWLERS -->
    <tr class="role-header"><td colspan="4">BOWLERS</td></tr>
    <tr id="p_abbott"><td><input type="checkbox" class="sel"></td><td>Sean Abbott</td><td>Australia</td><td>7</td></tr>
    <tr id="p_archer"><td><input type="checkbox" class="sel"></td><td>Jofra Archer</td><td>England</td><td>8</td></tr>
    <tr id="p_atkinson"><td><input type="checkbox" class="sel"></td><td>Gus Atkinson</td><td>England</td><td>7</td></tr>
    <tr id="p_bashir"><td><input type="checkbox" class="sel"></td><td>Shoaib Bashir</td><td>England</td><td>6</td></tr>
    <tr id="p_boland"><td><input type="checkbox" class="sel"></td><td>Scott Boland</td><td>Australia</td><td>7</td></tr>
    <tr id="p_carse"><td><input type="checkbox" class="sel"></td><td>Brydon Carse</td><td>England</td><td>7</td></tr>
    <tr id="p_cummins"><td><input type="checkbox" class="sel"></td><td>Pat Cummins</td><td>Australia</td><td>9</td></tr>
    <tr id="p_doggett"><td><input type="checkbox" class="sel"></td><td>Brendan Doggett</td><td>Australia</td><td>6</td></tr>
    <tr id="p_hazlewood"><td><input type="checkbox" class="sel"></td><td>Josh Hazlewood</td><td>Australia</td><td>8</td></tr>
    <tr id="p_lyon"><td><input type="checkbox" class="sel"></td><td>Nathan Lyon</td><td>Australia</td><td>8</td></tr>
    <tr id="p_potts"><td><input type="checkbox" class="sel"></td><td>Matthew Potts</td><td>England</td><td>7</td></tr>
    <tr id="p_tongue"><td><input type="checkbox" class="sel"></td><td>Josh Tongue</td><td>England</td><td>7</td></tr>
    <tr id="p_wood"><td><input type="checkbox" class="sel"></td><td>Mark Wood</td><td>England</td><td>8</td></tr>
  </tbody>
</table>

<div id="extras">
  <h2>Captain, tie-break, and entry</h2>
  <label for="captainSelect">Captain</label>
  <select id="captainSelect" disabled>
    <option value="">Select captain</option>
  </select>
  <small class="hint">Captain must be chosen from your selected XI.</small>

  <label for="viceSelect">Vice-Captain</label>
  <select id="viceSelect" disabled>
    <option value="">Select vice-captain</option>
  </select>
  <small class="hint">Vice-Captain must be different from Captain.</small>

  <label for="tieBreak">Tie-break: In total, how many runs will England score across the 5 test matches?</label>
  <input id="tieBreak" type="number" min="0" max="5000" placeholder="0–5000" />
  <small class="hint">Enter a number between 0 and 5000.</small>

  <button id="submitBtn" disabled>Submit Entry</button>
  <small class="hint">Button activates only when all validations pass.</small>
</div>

<script>
(function(){
  const table = document.getElementById('playerTable');
  const rows = [...table.querySelectorAll('tbody tr')].filter(r => !r.classList.contains('role-header'));
  const selCount = document.getElementById('selCount');
  const teamCost = document.getElementById('teamCost');
  const roleStatus = document.getElementById('roleStatus');
  const message = document.getElementById('message');

  const captainSelect = document.getElementById('captainSelect');
  const viceSelect = document.getElementById('viceSelect');
  const tieBreak = document.getElementById('tieBreak');
  const submitBtn = document.getElementById('submitBtn');

  const fullName = document.getElementById('fullName');
  const email = document.getElementById('email');

  const QUOTAS = { BATTERS: 5, ALLROUNDERS: 1, WICKETKEEPERS: 1, BOWLERS: 4 };
  const MAX_PLAYERS = 11;
  const BUDGET = 75;
  const SHEET_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycby9Aj-WqulsnBHHtUjRZUftWGiD-AmzyUK0oAnRvGbpnml6BnJ986gk7gqiT4T4mOR3/exec';

  function getRole(row){
    let r = row.previousElementSibling;
    while (r && !r.classList.contains('role-header')) r = r.previousElementSibling;
    return r ? r.textContent.trim().toUpperCase() : '';
  }
  function getPlayerName(row){ return row.cells[1].textContent.trim(); }

  function currentTotals(){
    const checkedRows = rows.filter(r => r.querySelector('.sel')?.checked);
    const totalCost = checkedRows.reduce((s, r) => {
      const m = r.cells[3].textContent.match(/([\d\.]+)/);
      return s + (m ? parseFloat(m[1]) : 0);
    }, 0);
    const roleCounts = { BATTERS:0, ALLROUNDERS:0, WICKETKEEPERS:0, BOWLERS:0 };
    checkedRows.forEach(r => {
      const role = getRole(r);
      if (roleCounts[role] !== undefined) roleCounts[role]++;
    });
    const selected = checkedRows.map(r => ({
      name: getPlayerName(r),
      role: getRole(r),
      country: r.cells[2].textContent.trim(),
      price: parseFloat(r.cells[3].textContent.match(/([\d\.]+)/)[1])
    }));
    return { checkedRows, totalCost, roleCounts, selected };
  }

  function populateCaptainVice(selectedNames){
    const enable = selectedNames.length === MAX_PLAYERS;
    captainSelect.disabled = !enable;
    viceSelect.disabled = !enable;

    captainSelect.innerHTML = '<option value="">Select captain</option>' + selectedNames.map(n=>`<option>${n}</option>`).join('');
    const viceNames = selectedNames.filter(n => n !== captainSelect.value);
    viceSelect.innerHTML = '<option value="">Select vice-captain</option>' + viceNames.map(n=>`<option>${n}</option>`).join('');
  }

  function validEmail(str){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(str); }

  function validateForm(){
    const { checkedRows, totalCost, roleCounts, selected } = currentTotals();
    const selectedNames = selected.map(s => s.name);

    selCount.textContent = checkedRows.length;
    teamCost.textContent = `£${totalCost.toFixed(1).replace(/\.0$/,'')}m / £${BUDGET}m`;
    selCount.className = checkedRows.length === MAX_PLAYERS ? 'ok' : 'bad';
    teamCost.className = totalCost <= BUDGET ? 'ok' : 'bad';

    const validRoles =
      roleCounts.BATTERS === QUOTAS.BATTERS &&
      roleCounts.ALLROUNDERS === QUOTAS.ALLROUNDERS &&
      roleCounts.WICKETKEEPERS === QUOTAS.WICKETKEEPERS &&
      roleCounts.BOWLERS === QUOTAS.BOWLERS;
    roleStatus.textContent = `Batters: ${roleCounts.BATTERS}/${QUOTAS.BATTERS} | Allrounders: ${roleCounts.ALLROUNDERS}/${QUOTAS.ALLROUNDERS} | Keepers: ${roleCounts.WICKETKEEPERS}/${QUOTAS.WICKETKEEPERS} | Bowlers: ${roleCounts.BOWLERS}/${QUOTAS.BOWLERS}`;
    roleStatus.className = validRoles ? 'ok' : 'bad';

    populateCaptainVice(selectedNames);
    const cap = captainSelect.value;
    const vice = viceSelect.value;

    const nameOk = fullName.value.trim().length >= 2;
    const emailOk = validEmail(email.value.trim());
    const countOk = checkedRows.length === MAX_PLAYERS;
    const budgetOk = totalCost <= BUDGET;
    const capOk = cap && selectedNames.includes(cap);
    const viceOk = vice && selectedNames.includes(vice) && vice !== cap;
    const tbOk = tieBreak.value !== '' && !isNaN(Number(tieBreak.value)) && Number(tieBreak.value) >= 0 && Number(tieBreak.value) <= 5000;

    const allOk = nameOk && emailOk && countOk && budgetOk && validRoles && capOk && viceOk && tbOk;

    submitBtn.disabled = !allOk;

    message.textContent = '';
    message.style.color = '#b00020';
    if (!nameOk) message.textContent = 'Please enter your full name.';
    else if (!emailOk) message.textContent = 'Please enter a valid email.';
    else if (!countOk) message.textContent = 'Select exactly 11 players.';
    else if (!budgetOk) message.textContent = 'Budget exceeded (£75m max).';
    else if (!validRoles) message.textContent = 'Team composition incorrect.';
    else if (!capOk) message.textContent = 'Select a Captain.';
    else if (!viceOk) message.textContent = 'Select a different Vice-Captain.';
    else if (!tbOk) message.textContent = 'Enter a valid tie-break number.';

    return { allOk, payload: { fullName: fullName.value.trim(), email: email.value.trim(), captain: cap, viceCaptain: vice, tieBreakRuns: Number(tieBreak.value), teamCost: totalCost, selected } };
  }

  table.addEventListener('change', e => { if (e.target.classList.contains('sel')) validateForm(); });
  ['input','change'].forEach(evt => [fullName,email,tieBreak,captainSelect,viceSelect].forEach(el => el.addEventListener(evt, validateForm)));

  submitBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    const { allOk, payload } = validateForm();
    if (!allOk) return;
    try {
      await fetch(SHEET_WEBAPP_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      message.style.color = '#0b8a44';
      message.textContent = '✅ Entry submitted successfully! Thank you.';
      submitBtn.disabled = true;
    } catch (err) {
      message.style.color = 'red';
      message.textContent = '❌ Submission failed. Please try again.';
      console.error(err);
    }
  });

  validateForm();
})();
</script>

</body>
</html>