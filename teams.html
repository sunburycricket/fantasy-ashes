<!DOCTYPE html>
<html>
<head>
  <title>Teams</title>
  <link rel="stylesheet" href="style.css">

  <style>
    /* Fixed site-wide header */
    .site-header {
      background-color: skyblue;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.6rem;
      font-weight: bold;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }

    /* Fixed navbar just below header */
    .navbar {
      background: #0B1636;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 12px;
      position: fixed;
      top: 70px; /* sits just below header */
      left: 0;
      width: 100%;
      z-index: 999;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: 600;
    }

    .navbar a.active {
      text-decoration: underline;
    }

    /* Push page content down so it doesn't overlap fixed header+navbar */
    body {
      margin: 0;
      padding-top: 130px; /* header (70px) + navbar (60px approx) */
    }

    .teams-page {
      padding: 25px;
      background: #f5f5f5;
      min-height: 100vh;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: #0B1636;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      max-width: 1700px;
      margin: 0;
    }

    #tableWrap {
      overflow-x: auto;
      max-height: 2000px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }

    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      font-weight: 700;
      background: #f1f5f9;
      position: sticky;
      top: 0;
      z-index: 5;
    }

    td, th { text-align: left; }

    .meta {
      color: #6b7280;
      font-size: 0.9rem;
    }

    .refresh {
      float: right;
      font-size: 0.9rem;
      color: #2563eb;
      cursor: pointer;
      text-decoration: underline;
    }

    /* Formatting helpers */
    .no-wrap { white-space: nowrap; }
    .center { text-align: center; }
    .red { color: red; }
  </style>
</head>
<body>

<!-- Fixed site-wide header -->
<div class="site-header">
  SUNBURY CRICKET CLUB - ASHES FANTASY FUNDRAISER
</div>

<!-- Fixed navbar -->
<div class="navbar">
  <a href="index.html">LEADERBOARD</a>
  <a class="active" href="teams.html">TEAMS</a>
  <a href="player-stats.html">PLAYER STATS</a>
  <a href="transfers.html">TRANSFERS</a>
  <a href="rules.html">RULES</a>
</div>

<div class="teams-page">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h1>Teams</h1>
      <div class="refresh" id="manualRefresh">Refresh</div>
    </div>

    <div id="lastUpdated" class="meta" style="margin-top:6px;">Last updated: —</div>
    <br>

    <div id="tableWrap">
      <table id="teamsTable">
        <thead><tr id="theadRow"></tr></thead>
        <tbody id="tbodyRow"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXkhOKdWeUqIOOUoD_Gp9BVXXu3yrdbhQd97rPUazXEdycwI33SjUpOW8-kNaCmeVpP0q5o1ChHc41/pub?gid=957102992&single=true&output=csv";
const REFRESH_MS = 30000;

function parseCSV(text) {
  const rows = [];
  let cur = "", row = [], inQuotes = false;
  for (let i = 0; i < text.length; i++) {
    const ch = text[i], nxt = text[i+1];
    if (ch === '"') {
      if (inQuotes && nxt === '"') { cur += '"'; i++; }
      else inQuotes = !inQuotes;
      continue;
    }
    if (ch === "," && !inQuotes) { row.push(cur); cur = ""; continue; }
    if ((ch === "\n" || ch === "\r") && !inQuotes) {
      if (cur !== "" || row.length > 0) { row.push(cur); rows.push(row); cur = ""; row = []; }
      if (ch === "\r" && nxt === "\n") i++;
      continue;
    }
    cur += ch;
  }
  if (cur !== "" || row.length > 0) { row.push(cur); rows.push(row); }
  return rows;
}

async function fetchAndRender() {
  try {
    const res = await fetch(CSV_URL, { cache: "no-store" });
    if (!res.ok) throw new Error("Fetch failed: " + res.status);
    const txt = await res.text();
    const rows = parseCSV(txt);

    if (!rows.length) throw new Error("No data found.");

    const header = rows[0];
    const data = rows.slice(1).filter(r => r.some(c => (c || "").trim() !== ""));

    renderTable(header, data);

    document.getElementById("lastUpdated").textContent =
      "Last updated: " + new Date().toLocaleString();
  } catch (err) {
    console.error(err);
    document.getElementById("lastUpdated").textContent =
      "Update failed: " + err.message;
  }
}

function renderTable(header, data) {
  const thead = document.getElementById("theadRow");
  const tbody = document.getElementById("tbodyRow");
  thead.innerHTML = "";
  tbody.innerHTML = "";

  // Build header
  header.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h || "—";
    if (/name/i.test(h || "")) {
      th.classList.add("no-wrap");
    }
    if (/£\s*available/i.test(h || "")) {
      th.classList.add("center", "red");
    }
    thead.appendChild(th);
  });

  // Build rows
  data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach((cell, ci) => {
      const td = document.createElement("td");
      td.textContent = cell ?? "";
      if (/name/i.test(header[ci] || "")) {
        td.classList.add("no-wrap");
      }
      if (/£\s*available/i.test(header[ci] || "")) {
        td.classList.add("no-wrap", "center", "red");
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

document.getElementById("manualRefresh").addEventListener("click", fetchAndRender);
fetchAndRender();
if (REFRESH_MS > 0) setInterval(fetchAndRender, REFRESH_MS);
</script>

</body>
</html>
