<!DOCTYPE html>
<html>
<head>
  <title>Transfers</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .site-header {
      background-color: skyblue;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.6rem;
      font-weight: bold;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }
    .navbar {
      background: #0B1636;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 12px;
      position: fixed;
      top: 70px;
      left: 0;
      width: 100%;
      z-index: 999;
    }
    .navbar a { color: white; text-decoration: none; font-weight: 600; }
    .navbar a.active { text-decoration: underline; }
    body { margin: 0; padding-top: 130px; background: #f5f5f5; }
    .transfers-page { padding: 25px; min-height: 100vh; }
    h1 { font-size: 1.8rem; margin-bottom: 0.25rem; color: #0B1636; }
    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      max-width: 1000px;
      margin: 0 auto;
    }

    table.transfer-table {
      width: 800px;
      border-collapse: collapse;
      table-layout: fixed; /* ensures fixed column widths are applied */
    }

    table.transfer-table th, 
    table.transfer-table td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left; /* default left align */
      box-sizing: border-box; /* keeps padding inside the fixed width */
    }

    table.transfer-table th {
      background: #f1f5f9;
      color: #0B1636;
    }

    /* Fixed widths for each column */
    table.transfer-table th:nth-child(1),
    table.transfer-table td:nth-child(1) {
      width: 100px; /* Role column */
      text-align: center; /* keep Role centered */
    }

    table.transfer-table th:nth-child(2),
    table.transfer-table td:nth-child(2) {
      width: 200px; /* Player OUT column */
    }

    table.transfer-table th:nth-child(3),
    table.transfer-table td:nth-child(3) {
      width: 200px; /* Player IN column */
    }

    /* Form controls */
    select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }

    .email-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .email-row label {
      font-weight: 600;
      color: #0B1636;
      white-space: nowrap;
    }
    /* Remove flex growth and fix email width */
    .email-row input {
      flex: 0 0 auto;
    }
    #email {
      width: 400px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    .submit-btn {
      background: #28a745; /* green */
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 20px;
    }
    .submit-btn:hover { background: #218838; }
    .out-selected { background-color: #ffcccc; }
    .in-selected { background-color: #ccffcc; }
  </style>
</head>
<body>

<div class="site-header">SUNBURY CRICKET CLUB - ASHES FANTASY FUNDRAISER</div>
<div class="navbar">
  <a href="index.html">LEADERBOARD</a>
  <a href="teams.html">TEAMS</a>
  <a href="player-stats.html">PLAYER STATS</a>
  <a class="active" href="transfers.html">TRANSFERS</a>
  <a href="rules.html">RULES</a>
</div>

<div class="transfers-page">
  <div class="card">
    <h1>Make Your Transfers</h1>
    <p>You may make up to <strong>TWO</strong> transfers before the start of the 2nd Test.</p>
    <p>Deadline: <strong>Tuesday 16th December at 11:30pm</strong>.</p>
    
  <ul style="margin-left: 0; padding-left: 20px;">
    <li>First, check your current team on the <a href="teams.html"><b>TEAMS</b></a> page.</li>
    <li>Complete the form below.</li>
    <li>Once submitted, it will be checked to ensure you have not exceed the <b>£86M</b> limit and the TEAMS page will then be updated.</li>
    <li>A ✅ will display by those entrants who have successfully submitted a transfer.</li>
    <li>If your transfer is rejected, a ❌ will display and you will receive an email.</li> 
  </ul>  
    
<div class="email-row">
  <label for="email">Email Address</label>
  <input id="email" type="email" placeholder="Enter your email address" required />
</div>



    <table class="transfer-table">
      <thead>
        <tr>
          <th>Role</th>
          <th>Player OUT</th>
          <th>Player IN</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <select id="role1" onchange="updatePlayers('role1','out1','in1')">
              <option value="">Select Role</option>
              <option value="Batters">Batter</option>
              <option value="Allrounders">Allrounder</option>
              <option value="Wicketkeepers">Wicketkeeper</option>
              <option value="Bowlers">Bowler</option>
            </select>
          </td>
          <td><select id="out1"><option value="">Select Player</option></select></td>
          <td><select id="in1"><option value="">Select Player</option></select></td>
        </tr>
        <tr>
          <td>
            <select id="role2" onchange="updatePlayers('role2','out2','in2')">
              <option value="">Select Role</option>
              <option value="Batters">Batter</option>
              <option value="Allrounders">Allrounder</option>
              <option value="Wicketkeepers">Wicketkeeper</option>
              <option value="Bowlers">Bowler</option>
            </select>
          </td>
          <td><select id="out2"><option value="">Select Player</option></select></td>
          <td><select id="in2"><option value="">Select Player</option></select></td>
        </tr>
      </tbody>
    </table>

    <button class="submit-btn" onclick="submitTransfers()">SUBMIT</button>
  </div>
</div>

<!-- Script continues in Part 2 -->
</body>

<script>
const players = {
  Batters: [
    {name:"Marcus Labuschagne", country:"Australia", cost:9},
    {name:"Joe Root", country:"England", cost:9},
    {name:"Steve Smith", country:"Australia", cost:9},
    {name:"Ben Duckett", country:"England", cost:8},
    {name:"Harry Brook", country:"England", cost:8},
    {name:"Travis Head", country:"Australia", cost:8},
    {name:"Usman Khawaja", country:"Australia", cost:8},
    {name:"Zak Crawley", country:"England", cost:7},
    {name:"Ollie Pope", country:"England", cost:7},
    {name:"Jacob Bethell", country:"England", cost:6},
    {name:"Jake Weatherald", country:"Australia", cost:6}
  ],
  Allrounders: [
    {name:"Cameron Green", country:"Australia", cost:9},
    {name:"Ben Stokes", country:"England", cost:9},
    {name:"Will Jacks", country:"England", cost:7},
    {name:"Beau Webster", country:"Australia", cost:7}
  ],
  Wicketkeepers: [
    {name:"Alex Carey", country:"Australia", cost:7},
    {name:"Josh Inglis", country:"Australia", cost:6},
    {name:"Jamie Smith", country:"England", cost:6}
  ],
  Bowlers: [
    {name:"Jofra Archer", country:"England", cost:8},
    {name:"Pat Cummins", country:"Australia", cost:8},
    {name:"Josh Hazlewood", country:"Australia", cost:8},
    {name:"Nathan Lyon", country:"Australia", cost:8},
    {name:"Mitchell Starc", country:"Australia", cost:8},
    {name:"Mark Wood", country:"England", cost:8},
    {name:"Sean Abbott", country:"Australia", cost:7},
    {name:"Gus Atkinson", country:"England", cost:7},
    {name:"Scott Boland", country:"Australia", cost:7},
    {name:"Brydon Carse", country:"England", cost:7},
    {name:"Michael Neser", country:"Australia", cost:7},
    {name:"Matthew Potts", country:"England", cost:7},
    {name:"Josh Tongue", country:"England", cost:7},
    {name:"Shoaib Bashir", country:"England", cost:6},
    {name:"Brendan Doggett", country:"Australia", cost:6},
    {name:"Matthew Fisher", country:"England", cost:6}
    
  ]
};

// Utility: populate a select with players, optionally excluding one name
function populateSelect(selectEl, list, excludeName = "") {
  selectEl.innerHTML = '<option value="">Select Player</option>';
  list.forEach(p => {
    if (p.name !== excludeName) {
      const optionText = `${p.name} (${p.country}) - £${p.cost}m`;
      selectEl.insertAdjacentHTML('beforeend', `<option value="${p.name}">${optionText}</option>`);
    }
  });
}

// Utility: add/remove highlight class based on selection
function applyHighlight(selectEl, className) {
  if (selectEl.value) {
    selectEl.classList.add(className);
  } else {
    selectEl.classList.remove(className);
  }
}

// Populate players when a role is chosen; keep OUT/IN in sync and highlighted
function updatePlayers(roleSelectId, outSelectId, inSelectId) {
  const role = document.getElementById(roleSelectId).value;
  const outSelect = document.getElementById(outSelectId);
  const inSelect = document.getElementById(inSelectId);

  // Reset selects and highlights
  outSelect.classList.remove('out-selected');
  inSelect.classList.remove('in-selected');
  outSelect.value = "";
  inSelect.value = "";
  outSelect.innerHTML = '<option value="">Select Player</option>';
  inSelect.innerHTML = '<option value="">Select Player</option>';

  if (role && players[role]) {
    // Fill both with the role's players
    populateSelect(outSelect, players[role]);
    populateSelect(inSelect, players[role]);

    // When OUT changes: highlight and rebuild IN excluding selected OUT
    outSelect.onchange = () => {
      applyHighlight(outSelect, 'out-selected');
      const selectedOut = outSelect.value;
      populateSelect(inSelect, players[role], selectedOut);
      inSelect.classList.remove('in-selected');
      inSelect.value = "";
    };

    // When IN changes: highlight
    inSelect.onchange = () => applyHighlight(inSelect, 'in-selected');
  }
}

// Validate email and require IN if OUT is chosen (for both rows)
function submitTransfers() {
  const email = document.getElementById('email').value.trim();
  const role1 = document.getElementById('role1').value;
  const out1 = document.getElementById('out1').value;
  const in1 = document.getElementById('in1').value;
  const role2 = document.getElementById('role2').value;
  const out2 = document.getElementById('out2').value;
  const in2 = document.getElementById('in2').value;

  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(email)) {
    alert("Please enter a valid email address before submitting.");
    return;
  }
  if (out1 && !in1) {
    alert("For Transfer 1, select a Player IN if you have chosen a Player OUT.");
    return;
  }
  if (out2 && !in2) {
    alert("For Transfer 2, select a Player IN if you have chosen a Player OUT.");
    return;
  }

  alert(`Email: ${email}
Transfer 1: ${role1 || "-"} | OUT: ${out1 || "-"} | IN: ${in1 || "-"}
Transfer 2: ${role2 || "-"} | OUT: ${out2 || "-"} | IN: ${in2 || "-"}`);
}
</script>

<script>
function submitTransfers() {
  const email = document.getElementById('email').value.trim();
  const role1 = document.getElementById('role1').value;
  const out1 = document.getElementById('out1').value;
  const in1 = document.getElementById('in1').value;
  const role2 = document.getElementById('role2').value;
  const out2 = document.getElementById('out2').value;
  const in2 = document.getElementById('in2').value;

  // Validate email
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(email)) {
    alert("Please enter a valid email address before submitting.");
    return;
  }
  // Validate transfers
  if (out1 && !in1) {
    alert("For Transfer 1, select a Player IN if you have chosen a Player OUT.");
    return;
  }
  if (out2 && !in2) {
    alert("For Transfer 2, select a Player IN if you have chosen a Player OUT.");
    return;
  }

  // Build payload
  const payload = { email, role1, out1, in1, role2, out2, in2 };

  // Your deployed Google Apps Script Web App URL
  const scriptURL = "https://script.google.com/macros/s/AKfycbwxLkKn-EQydHwSuqGj6l4sVAdJjVfCprVpKD78BJCq7xasa50aC10I1ZkoC1vSKZih/exec";

  // Send data to Google Sheet
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(response => response.text())
  .then(result => {
    alert("Transfer(s) successfully submitted");
    window.location.href = "index.html"; // redirect after success
  })
  .catch(error => {
    alert("Error submitting transfers: " + error);
  });
}
</script>
</body>
</html>
